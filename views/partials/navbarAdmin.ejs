<nav class="navbar" id="mainNav">
  <div class="navbar-container">
    <!-- SINISTRA -->
    <div class="navbar-logo-admin navbar-left">
      <a href="/" class="logo">ComixCity</a>
    </div>

    <!-- DESTRA -->
    <div class="navbar-right">
      <div class="search-container">
        <button class="search-toggle" aria-label="Cerca">
          <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" viewBox="0 0 24 24">
            <path d="M10 2a8 8 0 105.293 14.293l5.707 5.707 1.414-1.414-5.707-5.707A8 8 0 0010 2zm0 2a6 6 0 110 12 6 6 0 010-12z" />
          </svg>
        </button>

        <!-- Searchbar nascosta -->
        <div class="search-bar-wrapper" id="searchBar">
          <form class="search-form" data-prevent-submit>
            <input type="text" id="searchInput" name="q" placeholder="Cerca..." required autocomplete="off" />
            <div id="searchResults" class="search-results"></div>
          </form>
        </div>
      </div>

      <!-- Hamburger per mobile -->
      <button class="hamburger" id="hamburger" aria-label="Apri menu">
        &#9776;
      </button>

      <ul class="menu" id="menu">
        <li><a href="/biglietti">Biglietti</a></li>
        <li><a href="/eventi">Eventi</a></li>
        <li><a href="/stand">Stand</a></li>
        <% if (user && user.ruolo === 'admin') { %>
          <li><a href="/eventi/nuovo">+ Nuovo Evento</a></li>
        <% } %>
      </ul>
      <div class="menu-overlay" id="menuOverlay"></div>

      <!-- SEZIONE UTENTI -->
      <% if (user) { %>
        <% if (user.ruolo === 'admin') { %>
          <!-- ADMIN: Solo Admin Panel e Logout -->
          <a href="/admin" class="nav-btn">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24" class="icon-svg">
              <!-- Corona admin -->
              <path d="M12 2l2 4h4l-3 3 1 4-4-2-4 2 1-4-3-3h4l2-4z" />
            </svg>
            ðŸ‘‘ Admin
          </a>
          <a href="/logout" class="nav-btn login-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24" class="icon-svg">
              <!-- Porta con freccia -->
              <path d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" />
            </svg>
            Logout
          </a>
        <% } else { %>
          <!-- UTENTI NORMALI: Area Personale e Logout -->
          <a href="/areapersonale" class="nav-btn login-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24" class="icon-svg">
              <!-- Persona stilizzata -->
              <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
              <!-- Sparkle effect -->
              <circle cx="18" cy="6" r="1" opacity="0.7" />
              <circle cx="6" cy="18" r="1" opacity="0.7" />
            </svg>
            Area Personale
          </a>
          <a href="/logout" class="nav-btn login-link">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24" class="icon-svg">
              <!-- Porta con freccia -->
              <path d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" />
            </svg>
            Logout
          </a>
        <% } %>
      <% } else { %>
        <!-- UTENTI NON LOGGATI: Login e Registrati -->
        <a href="/login" class="nav-btn login-link">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24" class="icon-svg">
            <path d="M11 7L9.6 8.4l2.6 2.6H2v2h10.2l-2.6 2.6L11 17l5-5-5-5zm9-5H4c-1.1 0-2 .9-2 2v4h2V4h16v16H4v-4H2v4c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z" />
          </svg>
          Login
        </a>
        <a href="/register" class="nav-btn register-link">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24" class="icon-svg">
            <path d="M15 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm-9-2V8c0-.55-.45-1-1-1s-1 .45-1 1v2H2c-.55 0-1 .45-1 1s.45 1 1 1h2v2c0 .55.45 1 1 1s1-.45 1-1v-2h2c.55 0 1-.45 1-1s-.45-1-1-1H6zm9 4c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
          </svg>
          Registrati
        </a>
      <% } %>

      <!-- CARRELLO -->
      <a href="/carrello" class="nav-btn cart-link">
        Carrello
        <span class="cart-badge" id="cartBadge">
          <%= (carrello && carrello.length) ? carrello.length : 0 %>
        </span>
      </a>
    </div>
  </div>
</nav>